<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fcall">
<title>Data Structure • fcall</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Lora-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Structure">
<meta property="og:description" content="fcall">
<meta property="og:image" content="https://ketchbrookanalytics.github.io/fcall/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fcall</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Package Information</h6>
    <a class="dropdown-item" href="../getting-started.html">Getting Started</a>
    <a class="dropdown-item" href="../data-structure.html">Data Structure</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Database</h6>
    <a class="dropdown-item" href="../articles/database.html">Connecting to the Database (via ODBC)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ketchbrookanalytics/fcall/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Data Structure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ketchbrookanalytics/fcall/blob/HEAD/vignettes/data-structure.Rmd" class="external-link"><code>vignettes/data-structure.Rmd</code></a></small>
      <div class="d-none name"><code>data-structure.Rmd</code></div>
    </div>

    
    
<p>The information about each dataset is spread across two files, a
<strong>metadata file</strong> and a <strong>data file</strong>:</p>
<ol style="list-style-type: decimal">
<li>The <strong>metadata file</strong> contains information about the
columns in the <strong>data file</strong>, as well as lookup table(s)
for translating integer codes found in certain columns of the
<strong>data file</strong> into plain-English descriptions (if
applicable)</li>
<li>The <strong>data file</strong> contains the actual raw,
comma-separated Call Report data, without headers</li>
</ol>
<p>Metadata file names start with “D_”. We can use the file naming
conventions to link each <strong>metadata file</strong> with its
corresponding <strong>data file</strong>.</p>
<div class="section level3">
<h3 id="metadata-files">Metadata Files<a class="anchor" aria-label="anchor" href="#metadata-files"></a>
</h3>
<p>Each metadata file, in essence, contains the following information
about the variables in the corresponding data file:</p>
<ul>
<li>Variable name</li>
<li>Field type</li>
<li>Decimal positions</li>
<li>Variable description</li>
</ul>
<p>Metadata is stored by FCA in a way that is not straightforward to
process:</p>
<ul>
<li>Each metadata file has a description header that can span across
multiple lines</li>
<li>Information about a variable is not stored in a single line, as
variable descriptions can span across multiple lines (in an inconsistent
way)</li>
<li>Some metadata files have variable names that are preceded by two
asterisks (**). These asterisks are used to denote multiple-occurrence
columns and the first of them corresponds to a variable that stores
codes. Files with multiple-occurrence columns end with a NOTE that can
span across multiple lines.</li>
</ul>
<p>Nevertheless, there are some features of metadata files that come in
handy:</p>
<ul>
<li>Variable names are a single word (i.e., variable names are not
separated by spaces)</li>
<li>Field type is either “Numeric” or “Alphanum.” and is always placed
after a variable name</li>
<li>Decimal position is a single-digit integer that is always placed
after field type.</li>
</ul>
<p>These features allow us to use regular expressions to process
metadata files.</p>
<div class="section level4">
<h4 id="metadata-file-scenarios">Metadata File Scenarios<a class="anchor" aria-label="anchor" href="#metadata-file-scenarios"></a>
</h4>
<p>For the purposes of parsing files to create tidy data frames, the
metadata files are classified into the following unique scenarios:</p>
<ul>
<li>Scenario 1: All variables are single-occurrence (i.e., no variable
is preceded by two asterisks). This scenario is referred to as
“single”.</li>
<li>Scenario 2: A set of single-occurrence variables is followed by a
set of multiple-occurrence variables. This scenario will be referred as
“single_multiple”.</li>
<li>Scenario 3: A set of single-occurrence variables followed by a set
of multiple-occurrence variables is followed by a second set of
single-occurrence variables. This scenario will be referred as
“single_multiple_single”.</li>
</ul>
<p>This classification is important because the corresponding data file
will have a different structure depending on the scenario.</p>
</div>
</div>
<div class="section level3">
<h3 id="data-files">Data Files<a class="anchor" aria-label="anchor" href="#data-files"></a>
</h3>
<p>In general terms, the processing workflow of data files involves:</p>
<ol style="list-style-type: decimal">
<li>Reading data</li>
<li>Applying column names</li>
<li>Performing pivot operations (if necessary)</li>
</ol>
<p>Specific pivot operations depend on the <a href="#metadata-file-scenarios">scenario</a> of the corresponding
metadata file</p>
<div class="section level4">
<h4 id="scenario-1-single">Scenario 1 (“single”)<a class="anchor" aria-label="anchor" href="#scenario-1-single"></a>
</h4>
<p>This is the simplest scenario. The data in the data file is already
in the expected format, and the only task is to apply the column names
specified in the metadata file.</p>
</div>
<div class="section level4">
<h4 id="scenario-2-single_multiple">Scenario 2 (“single_multiple”)<a class="anchor" aria-label="anchor" href="#scenario-2-single_multiple"></a>
</h4>
<p>In this case, the data in the <strong>data file</strong> does not
adhere to “tidy” principles. The multiple-occurrence columns are
repeated for each class within the “code” variable. To help clarify the
previous statement, consider a <strong>data file</strong> has following
(mock) column names:</p>
<ul>
<li><code>ColumnA</code></li>
<li><code>ColumnB</code></li>
<li><code>Code1</code></li>
<li><code>Metric1_Code1</code></li>
<li><code>Metric2_Code1</code></li>
<li><code>Code2</code></li>
<li><code>Metric1_Code2</code></li>
<li><code>Metric2_Code2</code></li>
</ul>
<p>The corresponding <strong>metadata file</strong> would likely list
the column names as:</p>
<ul>
<li><code>ColumnA</code></li>
<li><code>ColumnB</code></li>
<li><code>Code</code></li>
<li><code>Metric1</code></li>
<li><code>Metric2</code></li>
</ul>
<p>This creates a mismatch between the number of columns identified in
the <strong>metadata file</strong> (5) and the number of columns in the
corresponding <strong>data file</strong> (8). To properly apply column
names to the <strong>data file</strong>, the total number of distinct
codes in the <code>Code</code> column must be determined. Once the
column names have been appropriately applied to the <strong>data
file</strong>, we complete the data processing by applying both long and
wide pivots.</p>
</div>
<div class="section level4">
<h4 id="scenario-3-single_multiple_single">Scenario 3 (“single_multiple_single”)<a class="anchor" aria-label="anchor" href="#scenario-3-single_multiple_single"></a>
</h4>
<p>This is the most complex scenario, currently applicable to only one
data file (<em>RCR7</em>). Unlike Scenario 2, there is an additional set
of single-occurrence columns that follow a set of multiple-occurrence
columns. For each observation in the <strong>data file</strong>, there
is a row that contains comma-separated values of variables that belong
to the first set of single-occurrence columns, followed by a row for
each class of the ‘code’ variable with comma-separated values of
multiple-occurrence variables, and finally, a row that contains
comma-separated values of the remaining single-occurrence columns.</p>
<p>In this case, the initial step of reading the data involves
concatenating lines corresponding to the same observation (using loops).
Once the data is read, the processing is similar to Scenario 2, except
when naming the columns it is necessary to consider that the repeating
columns are in the middle of the dataset. After naming the columns, the
processing is the same as in Scenario 2. The resulting dataset differs
from the metadata file in that it places all single-occurrence columns
at the beginning.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Thomas, Ivan Millanes, Ketchbrook Analytics.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
